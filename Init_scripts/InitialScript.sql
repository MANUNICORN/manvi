--CREATE USER "SHIFT101" PASSWORD 'password';
--CREATE ROLE "APPLICATION";
--GRANT APPLICATION TO "SHIFT101";


CREATE TABLE CALENDAR
( 
ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
MONTH INTEGER,
YEAR INTEGER,
LASTUPDATED TIMESTAMP,
LASTUPDATEDBY VARCHAR(20)
);

--grant ALL PRIVILEGES on CALENDAR to SHIFT101;


CREATE TABLE SHIFTS
( 
ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
shiftname VARCHAR(10),
shiftstart VARCHAR(4),
shiftend VARCHAR(4),
timezone VARCHAR(3),
LASTUPDATED TIMESTAMP,
LASTUPDATEDBY VARCHAR(20)
);

--grant ALL PRIVILEGES on SHIFTS to SHIFT101;

INSERT INTO SHIFTS(shiftname,shiftstart,shiftend,timezone,lastupdated,lastupdatedby) VALUES('General','0800','1630','IST',SYSDATE,'ADMIN');
INSERT INTO SHIFTS(shiftname,shiftstart,shiftend,timezone,lastupdated,lastupdatedby) VALUES('UK','1430','2230','IST',SYSDATE,'ADMIN');
INSERT INTO SHIFTS(shiftname,shiftstart,shiftend,timezone,lastupdated,lastupdatedby) VALUES('Morning','0630','1430','IST',SYSDATE,'ADMIN');
INSERT INTO SHIFTS(shiftname,shiftstart,shiftend,timezone,lastupdated,lastupdatedby) VALUES('Night','2230','0630','IST',SYSDATE,'ADMIN');



CREATE TABLE ROLES
( 
ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
ROLETYPE VARCHAR(25),
LASTUPDATED TIMESTAMP,
LASTUPDATEDBY VARCHAR(20)
);
--grant ALL PRIVILEGES on ROLES to SHIFT101;
INSERT INTO ROLES( "ROLETYPE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ('Administrator',CURRENT_TIMESTAMP , 'ADMIN');
INSERT INTO ROLES( "ROLETYPE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ('User',CURRENT_TIMESTAMP , 'ADMIN');
INSERT INTO ROLES( "ROLETYPE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ('LineManager',CURRENT_TIMESTAMP , 'ADMIN');
INSERT INTO ROLES( "ROLETYPE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ('Reconcile',CURRENT_TIMESTAMP , 'ADMIN');


CREATE TABLE USERDATA
( 
ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
NAME VARCHAR(50),
LASTUPDATED TIMESTAMP,
LASTUPDATEDBY VARCHAR(20)
);
--grant ALL PRIVILEGES on USERDATA to SHIFT101;
INSERT INTO USERDATA( "NAME", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ('Himanshu Sharma',CURRENT_TIMESTAMP , 'ADMIN');
INSERT INTO USERDATA( "NAME", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ('Deepak Singh',CURRENT_TIMESTAMP , 'ADMIN');


CREATE TABLE EXCEPTIONTYPES
( 
ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
EXCEPTIONNAME VARCHAR(25),
LASTUPDATED TIMESTAMP,
LASTUPDATEDBY VARCHAR(20)
);
--grant ALL PRIVILEGES on EXCEPTIONTYPES to SHIFT101;
INSERT INTO EXCEPTIONTYPES( "EXCEPTIONNAME", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ('Week-Off',CURRENT_TIMESTAMP , 'ADMIN');
INSERT INTO EXCEPTIONTYPES( "EXCEPTIONNAME", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ('Planned Leave',CURRENT_TIMESTAMP , 'ADMIN');
INSERT INTO EXCEPTIONTYPES( "EXCEPTIONNAME", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ('Unplanned Leave',CURRENT_TIMESTAMP , 'ADMIN');


CREATE TABLE SHIFTDATA
( 
ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
CALENDAR_ID INTEGER,
SHIFT_ID INTEGER,
EXCEPTION_ID INTEGER,
USER_ID INTEGER,
LASTUPDATED TIMESTAMP,
LASTUPDATEDBY VARCHAR(20)
);
ALTER TABLE PUBLIC.SHIFTDATA ADD FOREIGN KEY (SHIFT_ID) REFERENCES PUBLIC.SHIFTS(ID);
ALTER TABLE PUBLIC.SHIFTDATA ADD FOREIGN KEY (CALENDAR_ID) REFERENCES PUBLIC.CALENDAR(ID);
ALTER TABLE PUBLIC.SHIFTDATA ADD FOREIGN KEY (EXCEPTION_ID) REFERENCES PUBLIC.EXCEPTIONTYPES(ID);
ALTER TABLE PUBLIC.SHIFTDATA ADD FOREIGN KEY (USER_ID) REFERENCES PUBLIC.USERDATA(ID);
--grant ALL PRIVILEGES on SHIFTDATA to SHIFT101;

CREATE TABLE EXCEPTIONDATA
( 
ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
SHIFT_ID INTEGER,
EXCEPTION_ID INTEGER,
DATE INTEGER,
LASTUPDATED TIMESTAMP,
LASTUPDATEDBY VARCHAR(20)
);

ALTER TABLE PUBLIC.EXCEPTIONDATA ADD FOREIGN KEY (SHIFT_ID) REFERENCES PUBLIC.SHIFTDATA(ID);
ALTER TABLE PUBLIC.EXCEPTIONDATA ADD FOREIGN KEY (EXCEPTION_ID) REFERENCES PUBLIC.EXCEPTIONTYPES(ID);
/**
INSERT INTO "PUBLIC"."CALENDAR"
( "MONTH", "YEAR", "LASTUPDATED", "LASTUPDATEDBY" )
VALUES (12 , 2019, sysdate, 'ADMIN')


INSERT INTO "PUBLIC"."SHIFTDATA"( "CALENDAR_ID", "SHIFT_ID", "USER_ID", "LASTUPDATED", "LASTUPDATEDBY" ) 
VALUES ( 1, 1,0, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."SHIFTDATA"( "CALENDAR_ID", "SHIFT_ID", "USER_ID", "LASTUPDATED", "LASTUPDATEDBY" ) 
VALUES (1,  2,1, sysdate, 'ADMIN');



INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 27, 0, 2, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 27, 0, 3, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 27, 0, 9, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 27, 0, 10, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 27, 0, 16, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 27, 0, 17, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 27, 0, 23, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 27, 0, 24, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 27, 0, 30, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 27, 0, 31, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 27, 1, 4, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 27, 1, 13, sysdate, 'ADMIN');

INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 28, 0, 3, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 28, 0, 4, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 28, 0, 10, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 28, 0, 11, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 28, 0, 17, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 28, 0, 18, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 28, 0, 24, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 28, 0, 25, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 28, 0, 31, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 28, 2, 6, sysdate, 'ADMIN');
INSERT INTO "PUBLIC"."EXCEPTIONDATA" ( "SHIFT_ID", "EXCEPTION_ID", "DATE", "LASTUPDATED", "LASTUPDATEDBY" ) VALUES ( 28, 2, 13, sysdate, 'ADMIN');
;
*/

/**
select cal.month,cal.year,data.lastupdated,data.lastupdatedby,exp.id exception_id,
GROUP_CONCAT(date) exceptions,
user.name,user.id USER_ID,
exp.exceptionname,shift.shiftname,shift.id SHIFT_ID,
shift.shiftstart,shift.shiftend,shift.timezone
from calendar cal
join shiftdata data on calendar_id=cal.id
join userdata user on user.id=data.user_id
join shifts shift on shift.id=data.shift_id
join EXCEPTIONDATA edata on edata.shift_id=data.id
join exceptiontypes exp on exp.id=edata.exception_id
where cal.month=12 and cal.year=2019
group by cal.month,cal.year,user.name,
exp.exceptionname,shift.shiftname,shift.shiftstart,shift.shiftend,shift.timezone,data.lastupdated,data.lastupdatedby,user.id,shift.id,exp.id
*/
